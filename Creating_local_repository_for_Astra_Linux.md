Задача: Создать локальный репозиторий, в который будут включены определенные - выбранные пакеты, для переноса инфраструктуры и разворачивания ее на сервере без доступа к интернету.

Решение:

>Установим необходимые пакеты, подготовим ОС и создадим .iso образ.

1. Установим утилиту для создания локального репозитория apt-mirror.
```
sudo apt-get install apt-mirror
```
2. Настроим утилиту apt-mirror. (Следует указать директорию, в которую будет записываться иерархия каталогов и все файлы.)
```
# /etc/apt/mirror.list - конфигурационный файл.
sudo nano /etc/apt/mirror.list

# Директория, в которую складываем зеркало
set base_path    /var/spool/apt-mirror
```
3. Создадим директорию, в которую будет записаны данные и которую мы указали в конфигурационном файле. Так же выдадим права на данный каталог для пользователя apt-mirror.
```
sudo mkdir /var/spool/apt-mirror
sudo chown -R apt-mirror:apt-mirror /var/spool/apt-mirror
```
4. Запустим утилиту apt-mirror для создания копии репозитории.
```
sudo -u apt-mirror apt-mirror

##########################################################
Downloading 55 index files using 20 threads...
Begin time: Tue Dec 21 14:53:48 2010
[20]... [19]... [18]... [17]... [16]... [15]... [14]... [13]... [12]... [11]... [10]... [9]... [8]... [7]... [6]... [5]... [4]... [3]... [2]... [1]... [0]... 
End time: Tue Dec 21 14:54:06 2010
##########################################################
```
5. Установим программу для создания .iso образов из директорий.
```
sudo apt-get install brasero
```
6. Перейдем в brasero (Важно: при переносе - сохранить иерархию каталогов от каталога apt-mirror).

- Выберем "Диск с данными".
- Далее укажем путь к директории /var/spool/apt-mirror.
- Укажем путь, по которому будет сохранен .iso файл.

![image](https://github.com/busuek/Documentation/assets/101875725/49ce756c-344b-49e4-bae1-22f117bd73e5)

![image](https://github.com/busuek/Documentation/assets/101875725/37a0c161-56e3-45a7-b770-c4603159e938)

>Перенесем и развернём созданный .iso образ на другой машине.

1. Перейдем на машину и создадим директорию, куда будет примонтирован .iso образ.
```
sudo mkdir /mnt/disk
```
2. Перенесем .iso образ в директорию /mnt , далее примонтируем его в директорию /mnt/disk .
```
sudo mount -v /mnt/brasero.iso /mnt/disk
```
3. Сделаем запись с новым репозиторием в sources.list.
```
sudo nano /etc/apt/sources.list

#сделаем новую запись.
deb file:///mnt/disk/apt-mirror/mirror/download.astralinux.ru/astra/stable/1.7_x86-64/repository-main/ 1.7_x86-64 main
#закомментируем остальные строки файла, чтобы оставить только один источник пакетов.

sudo apt-get update
```
4. Можем установить любой пакет из подключенного образа для проверки.
```
sudo apt-get install htop
```
